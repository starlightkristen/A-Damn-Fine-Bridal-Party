<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - A Damn Fine Bridal Party</title>
    <link rel="stylesheet" href="./assets/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" 
            integrity="sha512-XMVd28F1oH/O71fzwBnV7HucLxVwtxf26XV8P4wPk26EDxuGZ91N8bsOttmnomcCD3CS5ZMRL50H0GgOHvegtg==" 
            crossorigin="anonymous" 
            referrerpolicy="no-referrer"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üå≤ A Damn Fine Bridal Party üå≤</h1>
            <p>Data Management & Validation</p>
        </header>

        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="decor.html">Decor</a></li>
                <li><a href="food.html">Food</a></li>
                <li><a href="mystery.html">Mystery</a></li>
                <li><a href="schedule.html">Schedule</a></li>
                <li><a href="guests.html">Guests</a></li>
                <li><a href="admin.html">Admin</a></li>
            </ul>
        </nav>

        <div class="card">
            <h2>üîß Data Validation</h2>
            <p>Check for data integrity issues, duplicate IDs, and invalid references:</p>
            <div id="validation-results">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Running validation...</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üìÅ Data Files</h2>
            <p>Direct links to all JSON data files for editing:</p>
            <div id="data-links">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading data links...</p>
                </div>
            </div>
            
            <div class="alert alert-warning">
                <strong>How to Update Data:</strong>
                <p>Use the on-site editors on the <strong>Decor</strong>, <strong>Food</strong>, <strong>Mystery</strong>, <strong>Schedule</strong>, and <strong>Guests</strong> pages to add, edit, or remove items. Use the <strong>Export</strong> button to download your JSON data and the <strong>Import</strong> button to load previously saved JSON files. The direct file links below remain available for manual JSON editing when needed.</p>
            </div>
        </div>

        <div class="card">
            <h2>üìä System Information</h2>
            <table>
                <tbody>
                    <tr>
                        <td><strong>Portal Version</strong></td>
                        <td>1.0.0</td>
                    </tr>
                    <tr>
                        <td><strong>Last Updated</strong></td>
                        <td id="last-updated">-</td>
                    </tr>
                    <tr>
                        <td><strong>GitHub Repository</strong></td>
                        <td><a href="https://github.com/starlightkristen/A-Damn-Fine-Bridal-Party" target="_blank">starlightkristen/A-Damn-Fine-Bridal-Party</a></td>
                    </tr>
                    <tr>
                        <td><strong>GitHub Pages URL</strong></td>
                        <td><a href="https://starlightkristen.github.io/A-Damn-Fine-Bridal-Party/" target="_blank">https://starlightkristen.github.io/A-Damn-Fine-Bridal-Party/</a></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="card" id="firebase-sync-status-card" style="display: none;">
            <h2>üîÑ Firebase Sync Status</h2>
            <table>
                <tbody>
                    <tr>
                        <td><strong>Data Source</strong></td>
                        <td id="sync-data-source">-</td>
                    </tr>
                    <tr>
                        <td><strong>Seeded</strong></td>
                        <td id="sync-seeded">-</td>
                    </tr>
                    <tr>
                        <td><strong>Seeded At</strong></td>
                        <td id="sync-seeded-at">-</td>
                    </tr>
                    <tr>
                        <td><strong>Seeded By</strong></td>
                        <td id="sync-seeded-by">-</td>
                    </tr>
                    <tr>
                        <td><strong>Last Local Sync</strong></td>
                        <td id="sync-last-sync">-</td>
                    </tr>
                </tbody>
            </table>
            <div style="margin-top: 20px;">
                <button onclick="forceSyncFromFirestore()" class="btn">üîÑ Force Sync Now</button>
                <p style="margin-top: 10px; font-size: 14px; color: #666;">
                    Force sync will reload all data from Firestore, discarding any unsaved local changes.
                </p>
            </div>
        </div>

        <div class="card">
            <h2>üéØ Quick Actions</h2>
            <div class="grid grid-2">
                <div>
                    <h3>Decor Wizard</h3>
                    <p>Guided decor planning with curated options</p>
                    <a href="decor-wizard.html" class="btn">üé® Start Decor Wizard</a>
                </div>
                <div>
                    <h3>Menu Planner</h3>
                    <p>Structured menu planning with dietary tracking</p>
                    <a href="menu-planner.html" class="btn">üçΩÔ∏è Start Menu Planner</a>
                </div>
                <div>
                    <h3>GitHub Issues</h3>
                    <p>Manage guest submissions and planning tasks</p>
                    <a href="https://github.com/starlightkristen/A-Damn-Fine-Bridal-Party/issues" class="btn" target="_blank">View Issues</a>
                </div>
                <div>
                    <h3>Submit Guests</h3>
                    <p>Add new guests via the issue form</p>
                    <a href="https://github.com/starlightkristen/A-Damn-Fine-Bridal-Party/issues/new?template=guest-list.yml" class="btn btn-secondary" target="_blank">Submit Form</a>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üìù Data Structure Reference</h2>
            
            <h3>guests.json</h3>
            <pre style="background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto;"><code>{
  "id": number,
  "name": "string",
  "email": "string",
  "phone": "string | null",
  "address": {
    "street": "string",
    "city": "string",
    "state": "string",
    "zip": "string",
    "country": "string"
  },
  "dietary": "string",
  "dietarySeverity": "allergy | intolerance | preference | null",
  "accessibility": "string",
  "roleVibe": "string",
  "seatingPreferences": "string | null",
  "notes": "string | null",
  "assignedCharacter": "string | null",
  "rsvp": "invited | confirmed | tentative | not attending | pending"
}</code></pre>

            <h3>characters.json</h3>
            <pre style="background: #f5f5f5; padding: 15px; border-radius: 5px; overflow-x: auto;"><code>{
  "id": "string",
  "name": "string",
  "role": "string",
  "briefing": "string",
  "costume": "string",
  "secret": "string",
  "personality": "string",
  "objective": "string"
}</code></pre>

            <div class="alert alert-info">
                <strong>Note:</strong> This portal uses client-side JavaScript to fetch and display JSON data. All data persists in the repository files. Changes to character assignments and other interactive features are in-memory only and will reset on page reload unless the JSON files are manually updated.
            </div>
        </div>

        <div class="card">
            <h2>üîí Limitations & Notes</h2>
            <ul class="item-list">
                <li><strong>No Backend:</strong> This is a static site with no server-side processing</li>
                <li><strong>In-Memory Changes:</strong> Interactive modifications (like assigning characters) are temporary unless you update the JSON files</li>
                <li><strong>Manual Data Updates:</strong> Edit JSON files directly in the repository to make permanent changes</li>
                <li><strong>Guest Submissions:</strong> Use GitHub Issues with the guest-list template to collect guest information</li>
                <li><strong>Printable Packets:</strong> Generated client-side using the browser's print dialog</li>
                <li><strong>Data Persistence:</strong> All data lives in the `/data` directory JSON files</li>
            </ul>
        </div>
    </div>

    <script src="./assets/app.js"></script>
    <script src="./assets/modules/render.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            await initApp();
            document.getElementById('last-updated').textContent = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Update Firebase sync status if enabled
            if (typeof getSyncStatusInfo === 'function') {
                const syncCard = document.getElementById('firebase-sync-status-card');
                if (syncCard) {
                    syncCard.style.display = 'block';
                    
                    const status = await getSyncStatusInfo();
                    document.getElementById('sync-data-source').textContent = status.dataSource;
                    document.getElementById('sync-seeded').textContent = status.seeded ? 'Yes ‚úì' : 'No';
                    document.getElementById('sync-seeded-at').textContent = status.seededAt 
                        ? new Date(status.seededAt).toLocaleString() 
                        : 'N/A';
                    document.getElementById('sync-seeded-by').textContent = status.seededBy || 'N/A';
                    document.getElementById('sync-last-sync').textContent = status.lastSync 
                        ? status.lastSync.toLocaleString() 
                        : 'Never';
                    
                    if (status.error) {
                        document.getElementById('sync-data-source').textContent += ` (${status.error})`;
                        document.getElementById('sync-data-source').style.color = '#8B0000';
                    }
                }
            }
        });
    </script>
</body>
</html>
