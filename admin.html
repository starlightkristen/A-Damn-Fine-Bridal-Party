<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - A Damn Fine Bridal Party</title>
    <link rel="stylesheet" href="./assets/styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js" 
            integrity="sha512-XMVd28F1oH/O71fzwBnV7HucLxVwtxf26XV8P4wPk26EDxuGZ91N8bsOttmnomcCD3CS5ZMRL50H0GgOHvegtg==" 
            crossorigin="anonymous" 
            referrerpolicy="no-referrer"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üå≤ A Damn Fine Bridal Party üå≤</h1>
            <p>Station Headquarters & Master Files</p>
        </header>

        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="decor.html">Decor</a></li>
                <li><a href="food.html">Food</a></li>
                <li><a href="mystery.html">Mystery</a></li>
                <li><a href="schedule.html">Schedule</a></li>
                <li><a href="guests.html">Residents</a></li>
                <li><a href="admin.html">Station HQ</a></li>
            </ul>
        </nav>

        <div id="page-notes-container"></div>

        <div class="card">
            <h2>üîß Case File Integrity</h2>
            <p>Scanning for investigation errors, duplicate resident IDs, and missing evidence:</p>
            <div id="validation-results">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Running case scan...</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üìÅ Event Files</h2>
            <p>Direct access to our planning data for review:</p>
            <div id="data-links">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading master files...</p>
                </div>
            </div>
            
            <div class="alert alert-warning">
                <strong>üí° Quick Tip for Us:</strong>
                <p>We can use the interactive editors on each page (Decor, Food, Mystery, Schedule, and Guests) to update things instantly. The buttons below are for downloading backups or importing previous versions if we ever need to "rewind" our progress.</p>
            </div>
        </div>

        <div class="card">
            <h2>üìä Station Logs</h2>
            <table>
                <tbody>
                    <tr>
                        <td><strong>Portal Version</strong></td>
                        <td>1.0.0 (Final)</td>
                    </tr>
                    <tr>
                        <td><strong>Last Log Entry</strong></td>
                        <td id="last-updated">-</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="card">
            <h2>‚öôÔ∏è Event Configuration</h2>
            <div id="settings-panel">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading configuration...</p>
                </div>
            </div>
        </div>

        <div class="card" id="firebase-sync-status-card" style="display: none;">
            <h2>üîÑ Real-Time Sync Status</h2>
            <table>
                <tbody>
                    <tr>
                        <td><strong>Cloud Connection</strong></td>
                        <td id="sync-data-source">-</td>
                    </tr>
                    <tr>
                        <td><strong>Data Secured</strong></td>
                        <td id="sync-seeded">-</td>
                    </tr>
                    <tr>
                        <td><strong>Last Cloud Update</strong></td>
                        <td id="sync-seeded-at">-</td>
                    </tr>
                    <tr>
                        <td><strong>Updated By Agent</strong></td>
                        <td id="sync-seeded-by">-</td>
                    </tr>
                    <tr>
                        <td><strong>Last Local Sync</strong></td>
                        <td id="sync-last-sync">-</td>
                    </tr>
                </tbody>
            </table>
            <div style="margin-top: 20px;">
                <button onclick="forceSyncFromFirestore()" class="btn">üîÑ Reload Cloud Data</button>
                <p style="margin-top: 10px; font-size: 14px; color: #666;">
                    This will refresh all data from our shared cloud database.
                </p>
            </div>
        </div>

        <div class="card">
            <h2>üéØ Direct Dispatch</h2>
            <div class="grid grid-2">
                <div>
                    <h3>Decor Wizard</h3>
                    <p>Step-by-step decor planning for our vision</p>
                    <a href="decor-wizard.html" class="btn">üé® Open Wizard</a>
                </div>
                <div>
                    <h3>Menu Planner</h3>
                    <p>Finalizing our coffee and pie selections</p>
                    <a href="menu-planner.html" class="btn">üçΩÔ∏è Open Planner</a>
                </div>
                <div>
                    <h3>Role Assignment</h3>
                    <p>Finalizing character roles for our guests</p>
                    <a href="role-assignment.html" class="btn">üé≠ Dispatch Roles</a>
                </div>
                <div>
                    <h3>Host Controls</h3>
                    <p>Live timing and mystery reveals for the party</p>
                    <a href="host-controls.html" class="btn">üé¨ Open Command Center</a>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üîí Field Notes & Confidential Info</h2>
            <ul class="item-list">
                <li><strong>No Tech Skills Required:</strong> I've built this so everything we change on the UI saves automatically.</li>
                <li><strong>Shared Planning:</strong> We can both be in here at once and see each other's updates in real-time.</li>
                <li><strong>Mystery Surprise:</strong> The mystery details are hidden from the main pages so only we can see the solution!</li>
                <li><strong>Print Readiness:</strong> All character packets are ready to be printed and sealed whenever we're ready.</li>
            </ul>
        </div>
    </div>

    <script src="./assets/app.js"></script>
    <script src="./assets/modules/render.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            await initApp();
            document.getElementById('last-updated').textContent = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            // Update Firebase sync status if enabled
            if (typeof getSyncStatusInfo === 'function') {
                const syncCard = document.getElementById('firebase-sync-status-card');
                if (syncCard) {
                    syncCard.style.display = 'block';
                    
                    const status = await getSyncStatusInfo();
                    document.getElementById('sync-data-source').textContent = status.dataSource;
                    document.getElementById('sync-seeded').textContent = status.seeded ? 'Yes ‚úì' : 'No';
                    document.getElementById('sync-seeded-at').textContent = status.seededAt 
                        ? new Date(status.seededAt).toLocaleString() 
                        : 'N/A';
                    document.getElementById('sync-seeded-by').textContent = status.seededBy || 'N/A';
                    document.getElementById('sync-last-sync').textContent = status.lastSync 
                        ? status.lastSync.toLocaleString() 
                        : 'Never';
                    
                    if (status.error) {
                        document.getElementById('sync-data-source').textContent += ` (${status.error})`;
                        document.getElementById('sync-data-source').style.color = '#8B0000';
                    }
                }
            }
        });
    </script>
</body>
</html>
